{% load staticfiles i18n %}
<div class="col-md-3" id="msgbox" data-name="{{ chat.name }}">
    <div class="box box-primary direct-chat direct-chat-primary">
        <div class="box-header with-border" id="loadmsg">
            <h3 class="box-title">
                {% for subscriber in chat.subscribers.all %}
                    {% ifequal request.user subscriber %}
                    {% else %}
                        {{ subscriber.username }}
                        <i class="fa fa-circle onlinestatus" id="status"></i>
                        <script>
                            (function getOnline(){
                                $.ajax({
                                    url: '{% url 'publicusers:getonline' subscriber.id %}',
                                    success: function(data) {
                                        var userstatus = $('#status');
                                        if (data.is_online) {
                                            $(userstatus).addClass('text-success');
                                        }
                                        else {
                                            $(userstatus).removeClass('text-success');
                                        }
                                    },
                                    complete: function() {
                                        setTimeout(getOnline, 15000);   
                                    }
                                });
                            })();
                        </script>
                    {% endifequal %}
                {% endfor %}
            </h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" id="msgclose"><i class="fa fa-times"></i></button>
            </div>
        </div>
        {% include "messagingsystem/chats.html" %}
    </div>
</div>
<script type="text/javascript">
    $("#msgclose").click(function(event) {
        $('#msgbox').fadeOut(300, function(){ $('#msgbox').remove();});
    });
</script>