{% comment %}
function getEkataUnitsInfo() {
    var url = '{% url 'myaccount:ekata_units_info' %}';
    $("#accountInfo").load(url, function () {
        $('html, body').animate({
            scrollTop: $("#accountInfo").offset().top
        }, 1000);
        $("#id_reciever").autocomplete({
            source: '{% url 'myaccount:get_ekata_units_users' %}',
            minLength: 2
        });
        $("#id_reciever").data("ui-autocomplete")._renderItem = function( ul, item ) {
            var li = $('<li>'), img = $('<img class="autocomplete-img">');
            img.attr({
                src: item.image,
                alt: item.value
            });
            li.attr('data-value', item.value);
            li.append('<p>');
            li.find('p').append(img).append(item.value);
            return li.appendTo(ul);
        };
        /*$("#ekataUnitsInfo").slimscroll({
            height: '200px',
            size: '3px'
        })*/
    });
}
{% comment %}
function getEkataUnitsInfo() {
    var url = '{% url 'myaccount:ekata_units_info' %}';
    $("#accountInfo").load(url);
}
{% endcomment %}
$("#ekataUnitsSubscribe").on('click', function(){
    $(this).text("Subscribing...");
    var url = '{% url 'myaccount:subscribe_ekata_units' %}';
    $.ajax({
        url: url,
        type: 'POST',
        success: function(data){
            $('.top-right').notify({
                message: { text: data.message },
                type: 'info'
            }).show();
            if (data.message === 'Subscribed') {
                $("#ekataUnitsSubscribe").text("Subscribed");
                getEkataUnitsInfo();
            }
        }
    });
});
$("#signupmodal").on('show.bs.modal', function(e){
    var link = '{% url 'autosignup:getform' %}?community_name=' + $(e.relatedTarget).attr('data-community-name');
    var self = $(this);
    $.ajax({
        url: link,
        success: function(data){
            $("#signupbody").load(data, function(){
                $("#gears").hide();
                $("#id_userimage").fileinput({'showUpload':false,});
            });
        }
    })
});
$("#signupsubmit").click(function(){
    var frm = $("#signupform");
    frm.hide();
    $("#gears").show();
    $("#signupfooter").hide();
    var data = new FormData(frm[0]);
    $.ajax({
        url: frm.attr('action'),
        type: frm.attr('method'),
        data: data,
        contentType: false,
        processData: false,
        success: function(data){
            if (data.action === 'next') {
                $("#signupbody").load(data.url, function(){
                    $("#gears").hide();
                    $("#signupfooter").show();
                    $("#id_userimage").fileinput({'showUpload':false,});
                });
            }
            else if (data.action === 'thankyou') {
                $("#signupbody").load(data.url, function(){
                    $("#gears").hide();
                });
            }
        },
        error: function(data) {
            $("#signupbody").html(data.responseText);
            $("#gears").hide();
            $("#signupfooter").show();
            $("#id_userimage").fileinput({'showUpload':false,});
        }
    });
});
$(document).on('click', '.signuplink', function(){
    var link = $(this).attr('href');
    var frm = $("#signupform");
    frm.hide();
    $("#gears").show();
    $("#signupfooter").hide();
    var data = new FormData(frm[0]);
    if (frm.attr('data-submit')) {
        if (frm.length) {
            $.ajax({
                url: frm.attr('action'),
                type: frm.attr('method'),
                data: data,
                contentType: false,
                processData: false,
                success: function(data){
                    if (data.action === 'next') {
                        $("#signupbody").load(data.url, function(){
                            $("#gears").hide();
                            $("#signupfooter").show();
                            $("#id_userimage").fileinput({'showUpload':false,});
                        });
                    }
                    else if (data.action === 'thankyou') {
                        $("#signupbody").load(data.url, function(){
                            $("#gears").hide();
                        });
                    }
                },
                error: function(data) {
                    $("#signupbody").html(data.responseText);
                    $("#gears").hide();
                    $("#signupfooter").show();
                    $("#id_userimage").fileinput({'showUpload':false,});
                }
            });
        }
    }
    else {
        $("#signupbody").load(link, function () {
            $("#gears").hide();
            $("#signupfooter").show();
            $("#id_userimage").fileinput({'showUpload':false,});
        });
    }
    return false;
});
$(document).on('click', '#transferconfirm', function(){
    var amount = $("#id_units").val();
    var to_user = $("#id_reciever").val();
    $("#confirmText").text('Transfer ' + amount + ' GRT to ' + to_user + '?');
    $("#transferConfirmModal").modal('show');
});
$(document).on('click', '#transfersubmit', function () {
    $("#transferConfirmModal").modal('hide');
    var frm = $("#transferform");
    $.ajax({
        url: frm.attr('action'),
        type: frm.attr('method'),
        data: frm.serialize(),
        success: function (data) {
            $('.top-right').notify({
                message: { text: data },
                type: 'success'
            }).show();
            getEkataUnitsInfo();
        },
        error: function (data) {
            $("#transferformcontainer").html(data.responseText);
            $("#id_reciever").autocomplete({
                source: '{% url 'myaccount:get_ekata_units_users' %}',
                minLength: 2
            });
        }
    });
});
$(document).on('click', '#getNewAddress', function () {
    var url = '{% url 'myaccount:get_new_address' %}';
    $.ajax({
        url: url,
        type: 'POST',
        success: function () {
            getEkataUnitsInfo();
        },
        error: function () {
            $('.top-right').notify({
                message: { text: 'Error getting address!! try later' },
                type: 'danger'
            }).show();
        }
    });
});
$(document).on('click', '.getqrcode', function () {
    var address = $(this).data('address');
    $("#qrcodecontent>img").remove();
    $("#qrAddress").text(address);
    $("#qrcodecontent").qrcode({
        render: 'image',
        text: address
    });
    $("#qrCodeModal").modal('show');
});
{% if communitysignup %}
    {% if communitysignup.data_collect_done %}
        {% if communitysignup.status == 'approved' %}
        $(document).ready(function () {
            getEkataUnitsInfo();
        });
        {% endif %}
    {% endif %}
{% endif %}
{% endcomment %}
